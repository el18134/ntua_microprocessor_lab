		LXI B,01F4H	;Αρχικοποίηση χρονοκαθυστέρησης σε 500ms=0,5sec
		IN 20H
		ANI 01H
		MOV E,A	;Αρχικοποίηση Ε στον οποίο αποθηκεύουμε την τιμή του LSB
		MVI A,FEH	;Αρχικοποίηση της θέσης του βαγονέτου 
		OUT 30H
		CALL DELB
		
LEFT:		RLC		;Αριστερή περιστροφή
		OUT 30H	
		CALL DELB
		CALL CHECK	;Κλήση ρουτίνας ελέγχου αλλαγής κατεύθυνσης
		MOV D,A
		MOV A,H
		CPI 00H	;Έλεγχος σημαίας αλλαγής κατεύθυνσης η οποία ανανεώνεται από την ρουτίνα ελέγχου 
		MOV A,D	
		JZ LEFT	;Αν η σημαία είναι 0 δεν αλλάζει η κατεύθυνση 
		JMP RIGHT	;Αν είναι 1 αλλάζουμε σε δεξιά περιστροφη
				
RIGHT:		RRC		;Δεξιά περιστροφή
		OUT 30H
		CALL DELB
		CALL CHECK	;Κλήση ρουτίνας ελέγχου αλλαγής κατεύθυνσης
		MOV D,A
		MOV A,H
		CPI 00H	;Έλεγχος σημαίας αλλαγής κατεύθυνσης η οποία ανανεώνεται από την ρουτίνα ελέγχου
		MOV A,D
		JZ RIGHT	;Αν η σημαία είναι 0 δεν αλλάζει η κατεύθυνση
		JMP LEFT	;Αν είναι 1 αλλάζουμε σε αριστερή περιστροφη
		
CHECK:		PUSH PSW	;Ρουτίνα ελέγχου αλλαγής κατεύθυνσης
		MOV L,A
STATIC:	IN 20H		;Έλεγχος λειτουργίας προγράμματος (έλεγχος MSB)
		MOV D,A
		RAL
		JNC STATIC
		MOV A,L
		MVI H,00H	
		CPI 7FH	;Έλεγχος αν βρισκόμαστε στο αριστερό άκρο
		JNZ C2
		MVI H,01H	;Αν βρισκόμαστε τότε το βαγονέτο πρέπει να αλλάξει κατεύθυνση ανεξάρτητα του LSB οπότε η σημαία αλλαγής γίνεται 1
		CALL DELB	;Έξτρα αναμονή 0,5sec για συνολική αναμονή 1sec στα άκρα
		JMP EXIT	;Έξοδος από την ρουτίνα ελέγχου
C2:		CPI FEH	;Έλεγχος αν βρισκόμαστε στο δεξί άκρο
		JNZ CONT
		MVI H,01H	;Αν βρισκόμαστε τότε το βαγονέτο πρέπει να αλλάξει κατεύθυνση ανεξάρτητα του LSB οπότε η σημαία αλλαγής γίνεται 1
		CALL DELB	;Έξτρα αναμονή 0,5sec για συνολική αναμονή 1sec στα άκρα
		JMP EXIT	;Έξοδος από την ρουτίνα ελέγχου

CONT:		MOV A,D	;Αν δεν βρισκόμαστε στα άκρα ελέγχουμε το LSB
		ANI 01H
		MOV L,A	;Κάνουμε XOR του LSB με την τελευταία τιμή του
		XRA E		;Αν είναι διαφορετικό δηλαδή ζητήθηκε αλλαγή κατεύθυνσης η σημαία γίνεται 1(1 XOR 0 = 1) 
		MOV E,L	;Αν δεν είναι διαφορετικό δηλαδή δεν ζητήθηκε αλλαγή κατεύθυνσης η σημαία γίνεται 0(0 XOR 0 = 1 XOR 1 = 0) 
		MOV H,A
EXIT:		POP PSW
		RET

		END